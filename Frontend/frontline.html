<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Frontline Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        "background-light": "#F8FAFC",
                        "background-dark": "#1F2937",
                        "card-light": "#FFFFFF",
                        "card-dark": "#374151",
                        "text-light": "#1F2937",
                        "text-dark": "#F3F4F6",
                        "border-light": "#E5E7EB",
                        "border-dark": "#4B5563",
                    },
                    fontFamily: {
                        display: ["Roboto", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                    },
                },
            },
        };
    </script>
    <style>
        .material-icons {
            font-size: inherit;
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>

</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
    <div class="flex h-screen" id="app">
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden md:hidden z-10"></div>

        <aside class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-card-dark transition-transform -translate-x-full md:relative md:translate-x-0 md:flex-shrink-0 z-20" id="sidebar">
            <div class="flex items-center justify-between p-4 border-b border-border-light dark:border-border-dark">
                <h1 class="text-xl font-bold text-primary">Frontline Portal</h1>
                <button class="md:hidden" id="close-sidebar">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <nav class="p-4">
                <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Quick Actions</p>
                <button type="button" id="open-register" class="w-full mt-2 bg-primary text-white py-2 px-4 rounded-lg flex items-center justify-center font-semibold">
                    <span class="material-icons mr-2">person_add</span>
                    Register Patient
                </button>
                <div class="mt-6">
                    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Filters</p>
                    <ul class="mt-2 space-y-2">
                        <li>
                            <a class="flex items-center p-2 text-sm text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" href="#">
                                <span class="material-icons mr-3">today</span>
                                Today
                            </a>
                        </li>
                        <li>
                            <a class="flex items-center p-2 text-sm text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" href="#">
                                Antenatal
                            </a>
                        </li>
                        <li>
                            <a class="flex items-center p-2 text-sm text-gray-700 dark:text-gray-300 rounded-lg bg-blue-100 dark:bg-blue-900 font-semibold" href="#">
                                Malaria
                            </a>
                        </li>
                        <li>
                            <a class="flex items-center p-2 text-sm text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" href="#">
                                Immunization
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="mt-6">
                    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase">Offline</p>
                    <div class="mt-2 p-2 rounded-lg bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 flex items-center">
                        <span class="material-icons mr-3">sync</span>
                        <span>24 pending</span>
                    </div>
                </div>
            </nav>
        </aside>

        <main class="flex-1 overflow-y-auto bg-gray-50">
            <div class="p-4 sm:p-6 lg:p-8 space-y-6 max-w-7xl mx-auto"></div>
            <header class="bg-white dark:bg-card-dark shadow-sm sticky top-0 z-10">
                <div class="mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <button class="md:hidden" id="open-sidebar">
                            <span class="material-icons">menu</span>
                        </button>
                        <nav class="hidden md:flex items-center space-x-8">
                            <button data-tab="patient-management" class="tab-btn text-sm font-medium text-primary border-b-2 border-primary">Patient Management</button>
                            <button data-tab="inventory" class="tab-btn text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-primary">Inventory</button>
                            <button data-tab="visits" class="tab-btn text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-primary">Visits</button>
                            <button data-tab="reports" class="tab-btn text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-primary">Reports</button>
                        </nav>
                        <div class="flex items-center space-x-4">
                            <div class="relative hidden sm:block">
                                <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                                <input class="bg-gray-100 dark:bg-gray-700 border-none rounded-lg pl-10 pr-4 py-2 text-sm focus:ring-primary focus:border-primary" placeholder="Search" type="text" />
                            </div>
                            <button class="flex items-center text-sm font-medium text-gray-500 dark:text-gray-400">
                                EN
                                <span class="material-icons">arrow_drop_down</span>
                            </button>
                            <div class="flex items-center">
                                <img alt="A. Musa profile picture" class="rounded-full w-8 h-8" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCknFFiRUiAfGmSoErm4-I9bC2gB4dNHdjk3slrL-Qs8_PCSkGsb4cnUjnOmnTL4twkr4nlBhRL2NvtnlpI7zTcDuMjmsuTu5XuSHm_Adqyg5VAG1gH6m2nIDkaOn00a-KQFAZq45Hm8LTJcUHaVLHO7evHRgIBll5lJeRpHi-k1B5kZFFWqL5F-8ojIR9OaQqLRiiwAZPt7-6k8ExbdzFoi8mJQkt4Nv6KBpmyfUykeVLcXR-1KFrEiTSR536_hknrBNK7sxfRfRM" />
                                <span class="ml-2 text-sm font-medium hidden sm:block">A. Musa</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="p-4 sm:p-6 lg:p-8 space-y-6">
                <!-- Tab: Patient Management (default visible) -->
                <div id="patient-management" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Patient Registration + Triage -->
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-bold">Patient Management & Triage</h2>
                                <div class="flex items-center space-x-2">
                                    <button class="text-xs px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full flex items-center">
                                        <span class="material-icons text-sm mr-1">volume_up</span> Voice Enabled
                                    </button>
                                    <button class="text-xs px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full flex items-center">
                                        <span class="material-icons text-sm mr-1">translate</span> Multilingual
                                    </button>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-md font-semibold">Patient Registration</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Name <span class="text-red-500">Required</span></label>
                                        <input id="patient-name" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" type="text" />
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Age</label>
                                        <input id="patient-age" min="0" oninput="if(this.value < 0) this.value = 0;" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" type="number" />
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Sex</label>
                                        <select id="patient-sex" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm">
                                            <option value="" disabled selected>Select sex</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Visit Type</label>
                                        <select id="patient-visit" class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm">
                                            <option value="" disabled selected>Select visit type</option>
                                            <option value="Emergency">Emergency</option>
                                            <option value="Acute">Acute</option>
                                            <option value="Routine">Routine</option>
                                            <option value="Follow-up">Follow-up</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Symptoms</label>
                                    <div class="relative mt-1">
                                        <textarea id="patient-symptoms" class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" rows="2"></textarea>
                                        <span class="material-icons absolute right-3 top-3 text-gray-400">mic</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Vitals (e.g., BP:120/80, Temp:37.2)</label>
                                    <div class="relative mt-1">
                                        <input id="patient-vitals" class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" type="text" placeholder="e.g. BP:120/80; Temp:37.2" />
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Medical History (comma or newline separated)</label>
                                    <div class="relative mt-1">
                                        <textarea id="patient-medical-history" class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" rows="2" placeholder="e.g. Hypertension, Diabetes"></textarea>
                                    </div>
                                </div>
                                <div class="flex justify-end space-x-4">
                                    <button class="px-6 py-2 border border-primary text-primary rounded-lg font-semibold">Save Draft</button>
                                    <button id="start-triage" type="button" class="px-6 py-2 bg-primary text-white rounded-lg font-semibold flex items-center">
                                        <span class="material-icons mr-2">play_arrow</span>
                                        Start Triage
                                    </button>
                                </div>
                                <!-- area to show triage result -->
                                <div id="triage-result" class="mt-4 hidden bg-card-light dark:bg-card-dark p-3 rounded-lg">
                                    <h4 class="font-semibold">Triage result</h4>
                                    <div id="triage-urgency" class="mt-2"></div>
                                    <div id="triage-actions" class="mt-2"></div>
                                    <div id="triage-reasoning" class="mt-2 text-sm text-gray-600"></div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Triage Assistant -->
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <h2 class="text-lg font-bold mb-4">AI Triage Assistant</h2>
                            <div class="space-y-4">
                                <!-- chat area -->
                                <div id="triage-chat" class="space-y-3 max-h-56 overflow-y-auto p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                    <!-- messages appended here -->
                                </div>

                                <!-- input: patient ID -->
                                <div class="relative mt-2 flex items-center">
                                    <input id="triage-input" class="flex-1 pr-24 rounded-lg border border-border-light dark:border-border-dark dark:bg-gray-700 focus:ring-primary focus:border-primary px-3 py-2" type="text" placeholder="Input patient ID" />
                                    <button id="triage-send" class="ml-3 px-4 py-2 bg-primary text-white rounded-lg font-semibold text-sm">Send</button>
                                    <div id="triage-loading" class="ml-2 hidden text-sm text-gray-500">Loading...</div>
                                </div>
                                <div class="flex justify-end space-x-2">
                                    <button id="triage-clear" class="text-xs px-3 py-1 border border-gray-300 rounded-full">Clear Chat</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Referral + Queue (also on Patient Management) -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <h2 class="text-lg font-bold mb-4">Referral Generator</h2>
                            <img alt="Map showing nearby hospitals" class="w-full h-48 object-cover rounded-lg mb-4" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBgSPfil0q576LBE3MY8iemTgFft2TCls_6R7KZb5ZB0grRe9npieVwzXB7QSvDXmNUJU8sHDs-RJl5GJOnbJ1a6sDs5o2pb-QIHYpptJ5hRU821nS4r9gDuOkHkm_q5AotdlsXIjutCeEY1GUDV55p2sm2-G0PfDiRVgyeJTQqdfCCxBinI17VQ7BRV9_l5MIQZTZvbYz-rKEx2OWCq4FND-JUZ1DGoXaHS5iD9LS3ZA8zZfIE0zX7diX23y4VepMIPOSsVkMgA9A" />
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 border border-border-light dark:border-border-dark rounded-lg">
                                    <div>
                                        <h3 class="font-semibold">General Hospital Kura</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Capacity: High • 15 min</p>
                                    </div>
                                    <button class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Select</button>
                                </div>
                                <div class="flex items-center justify-between p-3 border border-border-light dark:border-border-dark rounded-lg">
                                    <div>
                                        <h3 class="font-semibold">PHC Dawakin</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Capacity: Medium • 25 min</p>
                                    </div>
                                    <button class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Select</button>
                                </div>
                                <div class="flex items-center justify-between p-3 border border-border-light dark:border-border-dark rounded-lg">
                                    <div>
                                        <h3 class="font-semibold">Teaching Hospital</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Capacity: Low • 40 min</p>
                                    </div>
                                    <button class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Select</button>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <h2 class="text-lg font-bold mb-4">Queue & Forecast</h2>
                            <div class="grid grid-cols-3 gap-4 text-center mb-4">
                                <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                                    <p class="text-sm text-blue-800 dark:text-blue-200">Queue Length</p>
                                    <p class="text-3xl font-bold text-blue-900 dark:text-blue-100">12</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                                    <p class="text-sm text-blue-800 dark:text-blue-200">Wait Time (min)</p>
                                    <p class="text-3xl font-bold text-blue-900 dark:text-blue-100">35</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg">
                                    <p class="text-sm text-blue-800 dark:text-blue-200">Tomorrow Load</p>
                                    <p class="text-3xl font-bold text-blue-900 dark:text-blue-100">74</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 mb-4">
                                <input class="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" placeholder="Update wait time" type="text" />
                                <button class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Update</button>
                            </div>
                            <div class="p-2 bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-lg text-sm text-center">
                                AI Forecast updated 2 mins ago
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Inventory -->
                <div id="inventory" class="tab-content hidden">
                    <!-- Dashboard: Inventory + Workload + Feedback (from dashboard.html) -->
                    <section id="dash-inventory" class="bg-white dark:bg-card-dark p-4 rounded shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-medium">Inventory</h2>
                            <div class="flex items-center gap-2">
                                <button id="open-add-btn" class="bg-green-600 text-white px-3 py-1 rounded">Add Item</button>
                                <button id="show-lowstock-btn" class="bg-yellow-600 text-white px-3 py-1 rounded">Show Low Stock</button>
                                <input id="threshold-days" type="number" min="1" value="5" class="w-20 px-2 py-1 rounded border" title="Threshold days" />
                                <button id="create-restock-btn" class="bg-indigo-600 text-white px-3 py-1 rounded">Create Restock Requests</button>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="md:col-span-2 overflow-x-auto">
                                <table class="min-w-full text-sm">
                                    <thead class="bg-gray-100">
                                        <tr class="text-left">
                                            <th class="px-3 py-2">Item</th>
                                            <th class="px-3 py-2">Type</th>
                                            <th class="px-3 py-2">Stock</th>
                                            <th class="px-3 py-2">Daily</th>
                                            <th class="px-3 py-2">Days Left</th>
                                            <th class="px-3 py-2">Unit</th>
                                            <th class="px-3 py-2">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventory-tbody" class="bg-white divide-y divide-gray-100"></tbody>
                                </table>

                                <div class="flex items-center justify-between mt-3">
                                    <div class="text-sm">Total items: <span id="total-items">0</span></div>
                                    <div class="flex items-center gap-2">
                                        <button id="prev-page" class="px-3 py-1 rounded border bg-white">Prev</button>
                                        <span id="page-info" class="text-sm"></span>
                                        <button id="next-page" class="px-3 py-1 rounded border bg-white">Next</button>
                                    </div>
                                </div>
                            </div>

                            <aside class="bg-gray-50 p-3 rounded">
                                <h3 class="font-medium mb-2">Summary</h3>
                                <div class="mb-2">Low stock items: <strong id="lowstock-count">0</strong></div>
                                <div>Pending restock requests: <strong id="pending-reqs">0</strong></div>
                                <div class="mt-3 text-sm text-gray-600">Click Request to create a single restock request for an item.</div>
                            </aside>
                        </div>
                    </section>

                    <!-- Workload panel (from dashboard) -->
                    <section id="dash-workload" class="panel bg-white dark:bg-card-dark p-4 rounded shadow mt-6">
                        <h2 class="text-lg font-medium mb-2">Workload</h2>
                        <form id="workload-log-form" class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                            <input id="w-date" type="date" class="px-2 py-1 border rounded" />
                            <input id="w-count" type="number" placeholder="Patients seen" class="px-2 py-1 border rounded" />
                            <input id="w-queue" type="number" placeholder="Current queue" class="px-2 py-1 border rounded" />
                            <input id="w-wait" type="number" step="0.1" placeholder="Avg wait (mins)" class="px-2 py-1 border rounded" />
                            <input id="w-completed" type="number" placeholder="Completed visits today" class="px-2 py-1 border rounded" />
                            <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded">Log</button>
                        </form>

                        <div class="flex gap-3 items-center mb-3">
                            <input id="forecast-phc-id" type="number" value="1" class="px-2 py-1 border rounded w-28" />
                            <button id="forecast-btn" class="bg-indigo-600 text-white px-3 py-1 rounded">Forecast Next Day</button>
                        </div>

                        <div id="forecast-result" class="text-sm text-gray-800"></div>
                    </section>

                    <!-- Feedback panel (from dashboard) -->
                    <section id="dash-feedback" class="panel bg-white dark:bg-card-dark p-4 rounded shadow mt-6">
                        <h2 class="text-lg font-medium mb-2">Feedback</h2>
                        <form id="feedback-form" class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3">
                            <input id="f-phc-id" type="number" placeholder="PHC ID" class="px-2 py-1 border rounded" value="1" />
                            <input id="f-title" placeholder="Title" class="px-2 py-1 border rounded" />
                            <textarea id="f-body" placeholder="Feedback details" class="col-span-2 px-2 py-1 border rounded"></textarea>
                            <div class="col-span-2 flex justify-end gap-2">
                                <button type="submit" class="bg-indigo-600 text-white px-3 py-1 rounded">Submit</button>
                                <button id="load-feedback" type="button" class="bg-gray-200 px-3 py-1 rounded">Load for PHC</button>
                            </div>
                        </form>

                        <div id="feedback-list" class="space-y-2 text-sm"></div>
                    </section>
                </div>

                <!-- Tab: Reports -->
                <div id="reports" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <h2 class="text-lg font-bold mb-4">Monthly Summary</h2>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 border border-border-light dark:border-border-dark rounded-lg">
                                    <p class="font-medium">August 2025</p>
                                    <div class="flex space-x-2">
                                        <button class="px-4 py-1.5 border border-primary text-primary rounded-lg font-semibold text-sm">View</button>
                                        <button class="px-4 py-1.5 bg-primary text-white rounded-lg font-semibold text-sm">Download</button>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center p-3 border border-border-light dark:border-border-dark rounded-lg">
                                    <p class="font-medium">July 2025</p>
                                    <div class="flex space-x-2">
                                        <button class="px-4 py-1.5 border border-primary text-primary rounded-lg font-semibold text-sm">View</button>
                                        <button class="px-4 py-1.5 bg-primary text-white rounded-lg font-semibold text-sm">Download</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-card-dark p-6 rounded-lg shadow">
                            <h2 class="text-lg font-bold mb-4">Feedback & Issues</h2>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="text-sm font-medium">Category (e.g., no water)</label>
                                    <select class="mt-1 block w-full rounded-md border-gray-300 dark:border-border-dark dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"></select>
                                </div>
                                <div>
                                    <label class="text-sm font-medium">Priority</label>
                                    <select class="mt-1 block w-full rounded-md border-gray-300 dark:border-border-dark dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"></select>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="text-sm font-medium">Describe the issue...</label>
                                <textarea class="mt-1 block w-full rounded-md border-gray-300 dark:border-border-dark dark:bg-gray-700 shadow-sm focus:border-primary focus:ring-primary sm:text-sm" rows="2"></textarea>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button class="px-6 py-2 border border-primary text-primary rounded-lg font-semibold">Save</button>
                                <button class="px-6 py-2 bg-primary text-white rounded-lg font-semibold">Submit to LGA Admin</button>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-right">Offline-first: your feedback will sync when connectivity returns.</p>
                        </div>
                    </div>
                </div>
                <script>
                    // simple tab behaviour (works together with the DOMContentLoaded handler)
                    (function () {
                        function selectTab(name) {
                            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                            document.querySelectorAll('.tab-btn').forEach(b => {
                                b.classList.remove('text-primary', 'border-b-2', 'border-primary');
                                b.classList.add('text-gray-500');
                            });
                            const el = document.getElementById(name);
                            if (el) el.classList.remove('hidden');
                            const btn = document.querySelector('.tab-btn[data-tab="' + name + '"]');
                            if (btn) {
                                btn.classList.add('text-primary', 'border-b-2', 'border-primary');
                                btn.classList.remove('text-gray-500');
                            }
                        }
                        // default tab
                        window.selectTab = selectTab;
                        document.addEventListener('click', (e) => {
                            const tb = e.target.closest('.tab-btn');
                            if (tb && tb.dataset.tab) {
                                e.preventDefault();
                                selectTab(tb.dataset.tab);
                            }
                        });
                        // show patient-management by default on load
                        document.addEventListener('DOMContentLoaded', () => selectTab('patient-management'));
                    })();
                </script>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const openSidebarButton = document.getElementById('open-sidebar');
            const closeSidebarButton = document.getElementById('close-sidebar');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');

            function openSidebar() {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            }

            function closeSidebar() {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }

            openSidebarButton?.addEventListener('click', openSidebar);
            closeSidebarButton?.addEventListener('click', closeSidebar);
            overlay?.addEventListener('click', closeSidebar);

            // Optional: Close sidebar when clicking outside on mobile
            document.getElementById('app')?.addEventListener('click', (e) => {
                if (window.innerWidth < 768 && !sidebar.contains(e.target) && !openSidebarButton.contains(e.target)) {
                    closeSidebar();
                }
            });

            const dashboardData = {
                patients: {
                    antenatal: 42,
                    malaria: 58,
                    immunization: 33,
                    other: 19
                },
                stock: [{
                    name: "Paracetamol 500mg",
                    qty: 220
                }, {
                    name: "RDT Kits",
                    qty: 35
                }, {
                    name: "Amoxicillin",
                    qty: 0
                }]
            };

            const visitCards = document.getElementById("visit-cards");
            if (visitCards) {
                visitCards.innerHTML = Object.entries(dashboardData.patients)
                    .map(([k, v]) => `
                        <div class="bg-teal-500 p-4 rounded-lg text-white">
                            <p class="text-sm capitalize">${k}</p>
                            <p class="text-3xl font-bold">${v}</p>
                        </div>
                    `).join("");
            }

            const stockTable = document.getElementById("stock-table");
            if (stockTable) {
                stockTable.innerHTML = dashboardData.stock.map(item =>
                    `<tr><td class="py-2">${item.name}</td><td>${item.qty}</td><td></td></tr>`
                ).join("");
            }

            // API base
            const API_BASE = 'http://localhost:8000';

            async function registerPatient(payload) {
                const res = await fetch(`${API_BASE}/patients`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) {
                    const txt = await res.text();
                    throw new Error('Registration failed: ' + res.status + ' ' + txt);
                }
                return res.json();
            }

            async function callTriage(patientId) {
                const res = await fetch(`${API_BASE}/patients/triage/${patientId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                if (!res.ok) {
                    const txt = await res.text();
                    throw new Error('Triage failed: ' + res.status + ' ' + txt);
                }
                return res.json();
            }

            // --- Helpers for registration / form ---
            function parseList(text) {
                if (!text) return [];
                return text.split(/[\n,]+/).map(s => s.trim()).filter(Boolean);
            }

            function clearForm() {
                const ids = ['patient-name', 'patient-age', 'patient-sex', 'patient-visit', 'patient-symptoms', 'patient-vitals', 'patient-medical-history'];
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    if (el.tagName === 'SELECT') el.selectedIndex = 0;
                    else el.value = '';
                });
                const triage = document.getElementById('triage-result');
                if (triage) triage.classList.add('hidden');
            }

            function showSuccessOverlay(patientId) {
                const overlay = document.getElementById('success-overlay');
                if (!overlay) return;
                const idEl = overlay.querySelector('#success-overlay-id');
                if (idEl) idEl.textContent = patientId ?? 'unknown';
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                // auto-hide after 3s
                clearTimeout(window._successOverlayTimeout);
                window._successOverlayTimeout = setTimeout(() => {
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                }, 3000);
            }

            // --- Start triage (register patient) handler ---
            async function onStartTriageClick(e) {
                console.log('onStartTriageClick fired');
                e?.preventDefault();
                try {
                    const name = (document.getElementById('patient-name') || {}).value?.trim() || 'Anonymous';
                    const age = parseInt((document.getElementById('patient-age') || {}).value, 10) || 0;
                    const sex = (document.getElementById('patient-sex') || {}).value || 'Male';
                    const visit_type = (document.getElementById('patient-visit') || {}).value || 'Routine';
                    const symptoms = parseList((document.getElementById('patient-symptoms') || {}).value || '');
                    const vitals = (document.getElementById('patient-vitals') || {}).value || '';
                    const medical_history = parseList((document.getElementById('patient-medical-history') || {}).value || '');

                    if (!name) throw new Error('Name required');
                    if (age < 0) throw new Error('Age cannot be negative');

                    const payload = { name, age, sex, symptoms, visit_type, vitals, medical_history };
                    console.log('register payload', payload);

                    const patient = await registerPatient(payload);
                    console.log('Registered patient', patient);
                    showSuccessOverlay(patient.id);
                    clearForm();
                } catch (err) {
                    console.error(err);
                    alert(err.message || 'Error');
                }
            }

            // Chat helpers for triage assistant
            function appendChatMessage(who, text) {
                const container = document.getElementById('triage-chat');
                if (!container) return;
                const wrap = document.createElement('div');
                wrap.className = who === 'user' ? 'flex justify-end' : 'flex justify-start';
                const bubble = document.createElement('div');
                bubble.className = who === 'user'
                    ? 'max-w-[75%] bg-primary text-white px-3 py-2 rounded-lg rounded-br-none whitespace-pre-wrap'
                    : 'max-w-[75%] bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 px-3 py-2 rounded-lg rounded-bl-none whitespace-pre-wrap';
                bubble.textContent = text;
                wrap.appendChild(bubble);
                container.appendChild(wrap);
                container.scrollTop = container.scrollHeight;
            }

            function clearChat() {
                const container = document.getElementById('triage-chat');
                if (container) container.innerHTML = '';
            }

            // wire triage chat send
            document.getElementById('triage-send')?.addEventListener('click', async () => {
                const input = document.getElementById('triage-input');
                if (!input) return;
                const raw = input.value.trim();
                if (!raw) return alert('Enter patient ID');
                const patientId = isNaN(Number(raw)) ? raw : Number(raw);

                // show as user message
                appendChatMessage('user', `Triage request for patient ID: ${patientId}`);

                // show loading
                const sendBtn = document.getElementById('triage-send');
                const loading = document.getElementById('triage-loading');
                sendBtn.disabled = true;
                if (loading) loading.classList.remove('hidden');

                try {
                    const res = await callTriage(patientId);
                    // format assistant response
                    const actions = (res.recommended_actions || []).join(', ');
                    const assistantText = `Urgency: ${res.urgency_level}\nActions: ${actions}\nReasoning: ${res.reasoning}`;
                    appendChatMessage('assistant', assistantText);
                } catch (err) {
                    console.error(err);
                    appendChatMessage('assistant', 'Error: ' + (err.message || 'Request failed'));
                } finally {
                    sendBtn.disabled = false;
                    if (loading) loading.classList.add('hidden');
                }
            });

            // allow Enter to send
            document.getElementById('triage-input')?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('triage-send')?.click();
                }
            });

            document.getElementById('triage-clear')?.addEventListener('click', () => clearChat());

            document.getElementById('start-triage')?.addEventListener('click', onStartTriageClick);

            // --- Inventory Tabs ---
            document.querySelectorAll('.inventory-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    // Hide all content
                    document.querySelectorAll('.inventory-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    // Deactivate all buttons
                    document.querySelectorAll('.inventory-tab-btn').forEach(b => {
                        b.classList.remove('text-primary', 'border-primary');
                        b.classList.add('text-gray-500', 'border-transparent');
                    });
                    // Activate selected tab and content
                    document.getElementById(tabId).classList.remove('hidden');
                    btn.classList.add('text-primary', 'border-primary');
                    btn.classList.remove('text-gray-500', 'border-transparent');
                });
            });

            // --- Low Stock Table ---
            const lowStockData = [
                { name: "Paracetamol", type: "Drug", stock: 45, usage: 10, unit: "Tablets" },
                { name: "Gloves", type: "Supply", stock: 150, usage: 20, unit: "Pairs" },
                { name: "Syringes", type: "Supply", stock: 200, usage: 15, unit: "Units" },
                { name: "Amoxicillin", type: "Drug", stock: 120, usage: 10, unit: "Capsules" }
            ];

            const lowStockTableBody = document.getElementById('low-stock-table-body');

            function renderLowStockTable() {
                lowStockTableBody.innerHTML = '';
                lowStockData.forEach(item => {
                    const daysRemaining = item.usage > 0 ? Math.floor(item.stock / item.usage) : Infinity;
                    let colorClass = 'text-green-700 bg-green-100 dark:text-green-100 dark:bg-green-700';
                    if (daysRemaining <= 5) {
                        colorClass = 'text-red-700 bg-red-100 dark:text-red-100 dark:bg-red-700';
                    } else if (daysRemaining <= 10) {
                        colorClass = 'text-yellow-700 bg-yellow-100 dark:text-yellow-100 dark:bg-yellow-700';
                    }

                    const row = `
                        <tr class="border-b border-border-light dark:border-border-dark">
                            <td class="px-4 py-3">${item.name}</td>
                            <td class="px-4 py-3">${item.type}</td>
                            <td class="px-4 py-3">${item.stock}</td>
                            <td class="px-4 py-3">${item.usage}</td>
                            <td class="px-4 py-3"><span class="px-2 py-1 font-semibold leading-tight rounded-full ${colorClass}">${daysRemaining} days</span></td>
                            <td class="px-4 py-3">${item.unit}</td>
                            <td class="px-4 py-3"><button onclick="document.getElementById('request-restock-modal').classList.remove('hidden')" class="text-primary hover:underline">Request Restock</button></td>
                        </tr>
                    `;
                    lowStockTableBody.innerHTML += row;
                });
            }

            renderLowStockTable();

            // --- Summary Cards ---
            const restockRequestsData = [
                { id: 101, item: "Paracetamol", quantity: 500, phc: "PHC Ajah", date: "2025-10-11", status: "Pending", comments: "-" },
                { id: 102, item: "Syringe", quantity: 200, phc: "PHC Lekki", date: "2025-10-10", status: "Approved", comments: "Delivered" }
            ];

            function updateSummaryCards() {
                const totalStock = lowStockData.reduce((acc, item) => acc + item.stock, 0);
                const lowStockItems = lowStockData.filter(item => (item.stock / item.usage) <= 10).length;
                const pendingRequests = restockRequestsData.filter(req => req.status === 'Pending').length;
                const approvedRequests = restockRequestsData.filter(req => req.status === 'Approved').length;

                document.getElementById('total-stock').textContent = totalStock;
                document.getElementById('low-stock-items').textContent = lowStockItems;
                document.getElementById('pending-requests').textContent = pendingRequests;
                document.getElementById('approved-requests').textContent = approvedRequests;
            }

            updateSummaryCards();

            function showToast(id) {
                const toast = document.getElementById(id);
                toast.classList.remove('hidden');
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3000);
            }

            document.querySelector('#request-restock-modal button[type="submit"]').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('request-restock-modal').classList.add('hidden');
                showToast('toast-restock-sent');
            });

            document.querySelector('#update-stock-modal button[type="submit"]').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('update-stock-modal').classList.add('hidden');
                showToast('toast-stock-updated');
            });

            document.getElementById('open-register')?.addEventListener('click', () => {
                // open your registration panel/modal (implement UI action)
                alert('Open registration UI (implement)');
            });
        });
    </script>

    <!-- Success overlay (shown when registration succeeds) -->
    <div id="success-overlay" class="hidden fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-40">
        <div class="bg-white dark:bg-card-dark p-5 rounded-lg shadow-lg flex items-center space-x-4 cursor-pointer">
            <div class="w-12 h-12 flex items-center justify-center rounded-full bg-green-100 text-green-700">
                <span class="material-icons" style="font-size:28px">check</span>
            </div>
            <div>
                <p class="font-semibold text-gray-900 dark:text-text-dark">Logged successfully</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Patient ID: <span id="success-overlay-id" class="font-mono">#</span></p>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-5 right-5 space-y-2">
        <div id="toast-restock-sent" class="hidden bg-green-500 text-white py-2 px-4 rounded-lg shadow-md">
            Restock Request Sent
        </div>
        <div id="toast-stock-updated" class="hidden bg-green-500 text-white py-2 px-4 rounded-lg shadow-md">
            Stock Updated Successfully
        </div>
    </div>

    <!-- Inventory / Workload / Feedback script (wires dashboard behaviour inside frontline) -->
    <script>
        (function () {
            // use existing API_BASE if present
            const API_BASE = (window.API_BASE || 'http://localhost:8000');
            const DEFAULT_PHC_ID = 1;
            let currentPage = 1;
            const PAGE_SIZE = 50;

            const esc = s => s ? String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])) : '';

            const tbody = document.getElementById('inventory-tbody');
            const totalEl = document.getElementById('total-items');
            const lowstockEl = document.getElementById('lowstock-count');
            const pendingEl = document.getElementById('pending-reqs');
            const pageInfo = document.getElementById('page-info');

            document.getElementById('open-add-btn')?.addEventListener('click', () => document.getElementById('add-modal').classList.remove('hidden'));
            document.getElementById('close-add-btn')?.addEventListener('click', () => document.getElementById('add-modal').classList.add('hidden'));
            document.getElementById('prev-page')?.addEventListener('click', () => { if (currentPage > 1) loadInventory(currentPage - 1); });
            document.getElementById('next-page')?.addEventListener('click', () => { const pages = Math.max(1, Math.ceil((+totalEl.textContent || 0) / PAGE_SIZE)); if (currentPage < pages) loadInventory(currentPage + 1); });
            document.getElementById('show-lowstock-btn')?.addEventListener('click', showLowStock);
            document.getElementById('create-restock-btn')?.addEventListener('click', createRestockForThreshold);

            document.getElementById('add-item-form')?.addEventListener('submit', async e => {
                e.preventDefault();
                const payload = {
                    item_name: document.getElementById('f-item-name').value.trim(),
                    item_type: document.getElementById('f-item-type').value.trim() || undefined,
                    add_quantity: Number(document.getElementById('f-qty').value) || 0,
                    daily_consumption_rate: Number(document.getElementById('f-daily').value) || 0,
                    unit: document.getElementById('f-unit').value.trim() || undefined,
                    phc_id: DEFAULT_PHC_ID,
                    phc_name: 'PHC A'
                };
                try {
                    const res = await fetch(API_BASE + '/inventory/add-item', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!res.ok) throw new Error('Save failed');
                    await Promise.all([loadInventory(currentPage), refreshSummary()]);
                    document.getElementById('add-modal').classList.add('hidden');
                } catch (e) { console.error(e); alert('Failed to save item'); }
            });

            async function loadInventory(page = 1) {
                currentPage = page;
                try {
                    const res = await fetch(`${API_BASE}/inventory/items?page=${page}&page_size=${PAGE_SIZE}&phc_id=${DEFAULT_PHC_ID}`);
                    if (!res.ok) throw new Error('Failed to load');
                    const json = await res.json();
                    totalEl.textContent = json.total ?? 0;
                    renderInventory(json.items || []);
                    const pages = Math.max(1, Math.ceil((json.total || 0) / PAGE_SIZE));
                    pageInfo.textContent = `Page ${currentPage} / ${pages}`;
                } catch (e) {
                    console.error(e);
                    if (tbody) tbody.innerHTML = '<tr><td colspan="7" class="p-3 text-red-600">Error loading inventory</td></tr>';
                }
            }

            function renderInventory(items) {
                if (!tbody) return;
                tbody.innerHTML = '';
                if (!items.length) { tbody.innerHTML = '<tr><td colspan="7" class="p-3 text-gray-500">No items</td></tr>'; return; }
                for (const it of items) {
                    const days = (it.days_remaining !== null && it.days_remaining !== undefined) ? it.days_remaining : '-';
                    const tr = document.createElement('tr'); tr.className = 'hover:bg-gray-50';
                    tr.innerHTML = `<td class="px-3 py-2">${esc(it.item_name)}</td><td class="px-3 py-2">${esc(it.item_type || '')}</td>
                      <td class="px-3 py-2">${it.current_stock ?? 0}</td><td class="px-3 py-2">${it.daily_consumption_rate ?? '-'}</td>
                      <td class="px-3 py-2">${days}</td><td class="px-3 py-2">${esc(it.unit || '')}</td>
                      <td class="px-3 py-2"><button class="text-indigo-600 hover:underline btn-request">Request</button></td>`;
                    tr.querySelector('.btn-request').addEventListener('click', () => requestRestock(it));
                    tbody.appendChild(tr);
                }
            }

            async function requestRestock(item) {
                const suggested = item.daily_consumption_rate ? Math.max(1, Math.round(item.daily_consumption_rate * 7)) : Math.max(1, item.current_stock || 1);
                const payload = { item_name: item.item_name, quantity_needed: suggested, phc_id: item.phc_id || DEFAULT_PHC_ID, phc_name: item.phc_name || 'PHC A' };
                try {
                    const res = await fetch(API_BASE + '/inventory/restock-requests', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!res.ok) throw new Error('Request failed');
                    await refreshSummary(); alert('Restock requested');
                } catch (e) { console.error(e); alert('Failed to create restock request'); }
            }

            async function showLowStock() {
                const thr = Number(document.getElementById('threshold-days').value) || 5;
                try {
                    const res = await fetch(`${API_BASE}/inventory/low-stock?threshold_days=${thr}&phc_id=${DEFAULT_PHC_ID}`);
                    if (!res.ok) throw new Error('Failed');
                    const items = await res.json();
                    renderInventory(items);
                    lowstockEl.textContent = items.length ?? 0;
                } catch (e) { console.error(e); alert('Error fetching low stock'); }
            }

            async function createRestockForThreshold() {
                const thr = Number(document.getElementById('threshold-days').value) || 5;
                try {
                    const res = await fetch(`${API_BASE}/inventory/create-restock-for-threshold?threshold_days=${thr}&phc_id=${DEFAULT_PHC_ID}`, { method: 'POST' });
                    if (!res.ok) { const txt = await res.text(); throw new Error(txt || 'Failed'); }
                    const json = await res.json();
                    alert((json.created ?? 0) + ' requests created');
                    await refreshSummary(); await loadInventory(currentPage);
                } catch (e) { console.error(e); alert('Error creating requests'); }
            }

            async function refreshSummary() {
                try {
                    const resTotal = await fetch(`${API_BASE}/inventory/items?page=1&page_size=1&phc_id=${DEFAULT_PHC_ID}`);
                    if (resTotal.ok) { const js = await resTotal.json(); totalEl.textContent = js.total ?? 0; }
                    const thr = Number(document.getElementById('threshold-days').value) || 5;
                    const resLow = await fetch(`${API_BASE}/inventory/low-stock?threshold_days=${thr}&phc_id=${DEFAULT_PHC_ID}`);
                    if (resLow.ok) { const low = await resLow.json(); lowstockEl.textContent = low.length ?? 0; }
                    const resReq = await fetch(`${API_BASE}/inventory/restock-requests`);
                    if (resReq.ok) { const reqs = await resReq.json(); pendingEl.textContent = reqs.filter(r => r.status === 'pending').length; }
                } catch (e) { console.error('summary refresh failed', e); }
            }

            /* Workload handlers */
            document.getElementById('workload-log-form')?.addEventListener('submit', async e => {
                e.preventDefault();
                const payload = {
                    phc_id: DEFAULT_PHC_ID,
                    date: document.getElementById('w-date').value || undefined,
                    patient_count: Number(document.getElementById('w-count').value) || 0,
                    current_queue_count: Number(document.getElementById('w-queue').value) || 0,
                    avg_wait_time: Number(document.getElementById('w-wait').value) || 0,
                    completed_visits_today: Number(document.getElementById('w-completed').value) || 0
                };
                try {
                    const res = await fetch(API_BASE + '/workload/log', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const js = await res.json();
                    document.getElementById('forecast-result').textContent = res.ok ? 'Logged workload.' : `Error: ${JSON.stringify(js)}`;
                } catch (e) { console.error(e); alert('Failed to log workload'); }
            });

            document.getElementById('forecast-btn')?.addEventListener('click', async () => {
                const phc = Number(document.getElementById('forecast-phc-id').value) || DEFAULT_PHC_ID;
                try {
                    const res = await fetch(`${API_BASE}/workload/forecast/${phc}`, { method: 'POST' });
                    const js = await res.json();
                    if (!res.ok) { document.getElementById('forecast-result').textContent = 'Forecast error: ' + JSON.stringify(js); return; }
                    document.getElementById('forecast-result').textContent = `Forecast: ${JSON.stringify(js)}`;
                } catch (e) { console.error(e); alert('Forecast failed'); }
            });

            /* Feedback */
            document.getElementById('feedback-form')?.addEventListener('submit', async e => {
                e.preventDefault();
                const phcId = Number(document.getElementById('f-phc-id').value) || DEFAULT_PHC_ID;
                const title = document.getElementById('f-title').value.trim();
                const body = document.getElementById('f-body').value.trim();
                const payload = { phc_id: phcId, phc_name: 'PHC A', category: 'General', title: title, message: body };
                try {
                    const res = await fetch(API_BASE + '/feedback/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const js = await res.json();
                    if (res.ok) {
                        alert('Feedback submitted');
                        document.getElementById('feedback-list').insertAdjacentHTML('afterbegin', `<div class="p-2 border rounded"><strong>${esc(js.title || payload.title)}</strong><div class="text-sm">${esc(js.message || payload.message)}</div></div>`);
                    } else {
                        alert('Feedback error: ' + JSON.stringify(js));
                    }
                } catch (e) { console.error(e); alert('Failed to submit feedback'); }
            });

            document.getElementById('load-feedback')?.addEventListener('click', async () => {
                const phc = Number(document.getElementById('f-phc-id').value) || DEFAULT_PHC_ID;
                try {
                    const res = await fetch(`${API_BASE}/feedback/${phc}`);
                    const js = await res.json();
                    const list = document.getElementById('feedback-list');
                    list.innerHTML = '';
                    if (Array.isArray(js)) js.forEach(f => list.insertAdjacentHTML('beforeend', `<div class="p-2 border rounded"><strong>${esc(f.title || '')}</strong><div class="text-sm">${esc(f.body || '')}</div></div>`));
                    else list.textContent = JSON.stringify(js);
                } catch (e) { console.error(e); alert('Failed to load feedback'); }
            });

            // initialize
            (async function init() { await Promise.all([refreshSummary(), loadInventory(1)]); })();
        })();
    </script>

</body>

</html>